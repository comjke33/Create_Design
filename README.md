# Create_Design
[INU grade1 second semester] Create_Design 최병조 교수님

# 🚲 #
**프로젝트 진행상황:** 종료  
**팀명**: B.A.O.(Bike Always Okay)  
**프로젝트명**: 금쪽이 자전거    
**팀장**: 임베디드시스템공학과 장경은  
**팀원**: 임베디드시스템공학과 박상원, 박시우, 최수빈  
**[아이디어붐](http://www.ideaboom.net/project/project/view?seq=1333&comp_seq=80) 제품 등록일**: 2022.12.19  
**INU Maker 경진대회 결과**: 🏆대상  

### 역할분담 ###
- 소프트웨어 & 하드웨어: 장경은, 박시우
- 차체 외부 & 코스 제작: 박상원, 최수빈

### 수행배경 ###
- 아이가 자전거를 사용할 시, 이용자의 신체와 맞지 않아 자전거를 쉽게 조작할 수 없습니다.
- 센트럴파크나 인천대공원 같이 큰 공원을 둘러보면 아이들은 자유롭게 자전거를 타고 어른들은 이를 뒤따라 걷는 모습을 쉽게 찾아볼 수 있습니다.
- 이런 경우 순간적으로 사람에 의해 가려지거나 인파에 의해 자식을 잃어버릴 수 있습니다.
- 자전거를 막 타는 아이의 경우 다리 힘이 발달하지 않아 쉽게 밟기 어렵거나 패달을 멈춰야 할 때를 제대로 인지하지 못해 내리막에서 패달을 밟아 사고가 발생할 수 있습니다.
- 이 점들을 고려해 사용자의 위치를 파악하고, 사용자를 안전하게 보조해주는 유아용 자전거를 만들게 되었습니다.

### 수행시간 ###
- 11/9 ~ 11/10 : 아이디어 확정, 도면 제작, 물품 발주
- 11/11 ~ 11/15 : 외형 데모버전 만들기
- 11/16 ~ 11/20 : gps부분 만들기, 외형 전면 수정, 추가 발주
- 11/21 ~ 11/30 : 3d프린터로 출력 및 후가공, 모터가동 만들기, 1차 완성
- 12/1 ~ 12/19 : 납땜 및 최종 완성

### 활용 방안 ###
- 아이를 위한 자전거로 아이의 행동을 보조해줍니다.
- 로그인 시스템을 통해 위치 정보의 보안성을 유지할 수 있습니다.
- 오르막에서는 가속해 이용자를 돕고, 내리막에서는 속도를 제한해 사고 발생을 방지합니다.
- 자전거의 위치를 파악해 보호자에게 알려주어 미아가 되는 것을 방지할 수 있습니다.

### 사용한 부품 ###
- 모터 드라이버 모듈
- 아두이노 GPS 수신 모듈
- DC 모터 전용 실리콘 바퀴
- 아두이노 프로 마이크로 호환보드
- 엔코더
- 자이로 가속도 센서 모듈 MPU6050
- 아두이노 릴레이 5V 모듈
- 배터리
- 16*2 LCD 모듈

### 소개 영상 ###
[YOUTUBE](https://www.youtube.com/watch?v=YKCE9yNoVqQ)

### 개발작품 설명 ###
- 자전거의 위치 정보를 얻기 위해 GPS 수신 모듈로 NEO 7M 부품을 이용했습니다. 이 모듈은 기기 간 통신을 위한 전기적 인터페이스 및 데이터 송수신에 이용되는 프로토콜인 NMEA의 절차를 따릅니다. $로 시작하는 183개 종류의 Sentence ID를 통해 다양한 종류의 GPS 수신값을 받아들일 수 있습니다. 그리고 저희는 그 중 지리 정보와 고도, 경도 값을 읽을 수 있는 GPGLL로 시작하는 데이터값만 파싱하기로 하였습니다. 정보는 쉼표(,)로 구분되어 시간, 위도, 경도, checksum 등 순서대로 출력됩니다. 그리고 이것을 Bluetooth 시리얼을 통해 받아들여 앱 내에서 문자열을 조작 후, 구글 맵스에 위치를 표시합니다.
- 바퀴에 사용될 모터로 일반적으로 DC 모터와 기어박스를 이용했습니다. 그리고 이용자의 페달 용도로 엔코더를 이용했습니다. 엔코더는 모터의 회전속도와 방향을 알려주는 부품이지만, 저희는 자동차 바퀴 모터와는 별개로 속도 제어 부분에서 가속과 감속을 위한 trigger를 해줄 용도로 사용했습니다.
- 자이로 가속도 센서인 MPU6050을 이용해서 차체의 기울기를 감지해 오르막이나 내리막을 인지한 후 자동으로 가속이나 감속을 시켜주는 기능을 구현하고자 하였습니다. 지속적인 기준값 수정을 통해 가장 정확도가 높도록 조정하였습니다. 뿐만 아니라 급격한 센서값 감지를 통해 자전거가 넘어졌을 때를 감지할 수 있도록 구현했습니다. 그래서 애플리케이션에서 긴급상황을 인지할 수 있도록 하였습니다.
- 앞서 언급했듯이, bluetooth 모듈을 이용해 애플리케이션에 버튼값과 gps 센서값을 보내는 방식으로 통신했습니다. 애플리케이션에서 자유롭게 다양한 bluetooth 센서를 이용할 수 있도록 했고, 빠른 시연을 위해 기존에 이용하고 있는 모듈의 mac주소를 직접 연결할 수 있도록 추가로 연결 버튼을 구현했습니다.
- 테스트하던 중에 GPS 센서와 MPU6050 센서의 값을 각각 시리얼에 연결해 통신하도록 하면 서로 간섭이 생겨서 제대로된 값을 구현할 수 없다는 사실을 알게 되어, 정확한 시간 간격에 따라 두 센서값을 각각 활성화시킬 수 있도록 릴레이 5V 모듈을 이용하는 것으로 해결했습니다.
- 이 모든 기능을 구현할 보드로 아두이노 우노 호환보드를 이용했습니다. 기존에 소형화, 경량화를 이용해 아두이노 프로 마이크로 보드를 이용했으나, 핀 간의 간섭이 심하다는 것을 깨닫고 보드를 바꾸었습니다. 보드 내에서 객체 지향 방식으로 다양한 센서값을 읽어들이기 위해 Task Scheduler 방식을 이용하였습니다.
- 모터에 충분한 전압을 공급하기 위해서 DC 모터에 전지의 Raw 전압을 공급하고, 핸들 조작을 위한 서보모터에는 5V 전압을 공급했습니다.
- 저희는 부모의 유동적인 컨트롤을 위해 Kodular 프로그램으로 애플리케이션을 제작했습니다.
- 위치 정보와 같은 개인정보 보호를 위해 firebase 데이터베이스 시스템을 연동해 로그인 시스템을 제작했습니다
- 회원가입과 로그인 화면을 넘어가면, 블루투스 모듈 연결 화면이 뜨고 특정 모듈과 연결이 된다면 자동으로 자전거의 GPS 센서값과 방향 전환 버튼 키값을 받아오기 시작합니다.
- 다음은 디자인 설명입니다.
- 블렌더 프로그램을 이용하여 3D프린터로 프레임을 출력했고, 내경 5mm 베어링을 이용해서 핸들 조작을 구현했습니다.
- LightBurn 프로그램을 통해 레이저커터기를 이용하여 하드웨어 보호용 아크릴 외부 프레임을 제작했습니다.
- 자전거를 타는 어린이의 모습을 표현하기 위해 철사를 이용해 사람 모형을 제작했습니다.

### 대회 시연 ###
안녕하세요 저희는 ‘금쪽이 자전거’를 제작한 BAO팀입니다.

이 작품이 금쪽이 자전거라는 이름을 가지게 된 이유는 아이 발달 코칭 프로그램인 금쪽 같은 내새끼라는 TV 프로에서 아이들을 금쪽이라고 칭한 것에서 유래했습니다.

공원에서 자전거를 타는 아이들은 자유롭게 달리기도 하지만 그만큼 수많은 위험도 존재합니다. 저희는 이러한 위험을 선제적으로 차단하기 위해, 그리고 아이들의 쉬운 작동을 위해 속도를 유동적으로 제어할 수 있는 자전거를 제작해보기로 하였습니다.

먼저 겉모습을 설명하자면, 핸들 부분과 바퀴까지 이어지는 부분은 모두 3D펜으로 실측해 제작했습니다. 그리고 메인 프레임은 3D 프린터를 이용해서 뽑았고, 뒤쪽 부품상자와 코스는 레이저커터기를 이용해서 아크릴을 절단해 제작했습니다.

다음은 기술적인 부분에서 설명하겠습니다.

저희는 자이로 가속도 센서인 mpu6050과 블루투스 센서, GPS 센서, 릴레이 모듈, 모터 드라이버, 엔코더, 조향 시연을 위한 버튼과 서보모터, DC 모터 마지막으로 배터리까지 우노 호환보드에 연결해서 회로를 제작했습니다. 점퍼선보다 깔끔하고 확실히 연결할 수 있도록 직접 납땜을 해서 구상했습니다.

많은 센서들에게서 동시에 값을 받아오기 위해 객체 지향 방식의 task scheduler 라이브러리를 이용했습니다.

아이가 페달을 돌리면 오르막인지 내리막길인지를 구분해서 오르막길일때는 더 빠르게 가속을 해주고 내리막길에는 사고 방지를 위해 감속을 해주는 것이 일차적인 기능입니다.

그리고 방향을 자유롭게 조절할 수 있도록 베어링을 이용해서 핸들을 제작하였고, 저희는 시연을 위해서 서보모터를 달아서 직접 조작해볼 수 있도록 만들었습니다.

한번 조작해보시겠습니까??

여기 보시면 부모님의 휴대폰 애플리케이션과 블루투스 통신으로 이 자전거가 연결되어 있습니다.

그 전에 이 애플리케이션은 아이 위치 정보라는 개인정보를 보호하기 위해서 로그인 시스템이 구축되어있습니다. 이 앱은 kodular라는 앱인벤터 상위 버전 블록코딩 프로그램을 이용해서 만들었고, 로그인 시스템은 firebase라는 라이브러리를 직접 다운받아 추가해 데이터베이스를 기반으로 철저히 보안을 유지했습니다. 현재는 빠른 시연을 위해 자동로그인을 해둔 상태입니다.

만약 공원에 가서 많은 인파 속에 아이를 잃어버렸다면, 실시간으로 전송되는 GPS값을 통해 구글 맵스에 자전거 위치를 표시합니다. 즉, 전기 자전거의 역할과 미아방지 역할을 동시에 수행하는 것입니다.

현재는 부모님이 직접 자식의 자전거 제한속도를 설정할 수 있도록 기능을 추가한 상태입니다. 그리고 만약 자전거가 전복되는 등의 사고가 발생했을 때, 빠르게 앱으로 알림을 주어 부모가 알 수 있도록 하였습니다.

앞으로 앱에서 심박수와 운동량을 체크할 수 있는 헬스 케어 기능을 탑재하거나, 배터리 잔량을 표시해서 사용자가 알 수 있게 하는 방식 그리고 마지막으로 페달을 통해 모인 재생에너지를 다시 사용하는 친환경 방식도 추가하는 등 전망을 예측할 수 있습니다.

### 예상 질문 ###
1. 만드는데 어려움은 없었는가?
    1. 프레임을 제작하는데, 처음 다뤄보는 3D 프린터였기 때문에 실측한 것과 출력되어나온 것의 차이가 있다는 것을 뒤늦게 깨달았습니다. 그렇지만 디자인을 계속 다듬어서 결국 저희가 원하는 프레임 모양이 나왔고 설계도와 일치하게 완성해가는 과정을 통해 뿌듯했던 경험이 있습니다.
    2. 사실 맨처음에 소형화, 경량화를 위해 아두이노 프로 마이크로 보드를 이용했었는데, 그 보드는 핀 간의 간섭이 심해서 많은 센서를 연결해야하는 저희의 아이디어를 실현하기에는 어려움이 많았습니다. 결국 끊임없는 시도 끝에 아두이노 우노 보드로 변경하였고, 비교적 핀 간섭이 덜해서 정상 작동하는 것을 볼 수 있었습니다.
    3. 같은 시리얼을 공유하는 센서들이다보니, 다른 센서들이 GPS 센서값에 영향을 미쳐서 위치 정보를 쉽게 얻을 수 없었습니다. 특정한 규칙을 가지고 전송되는 정보를 파싱해서 문자열 처리를 통해 위치를 알아내는데, 계속 그 규칙을 무너뜨려서 생기는 문제였습니다. 그래서 저희는 센서들간의 보드레이트를 맞춰서 해결했습니다.
    4. update()라는 명령어가 있는데 이 명령어를 사용하면, 아두이노가 mpu센서값을 받아올 때까지 멈춰있고, 1000마이크로세컨드 안에 값을 주지 않으면 아두이노가 그걸 무시하지 못하고 계속 기다리기 때문에 결과적으로 전체 시스템이 멈춰버리는 프리즈 현상을 관찰했습니다. 저희는 이것을 해결하기 위해 wire 라이브러리에서 이 핀 자체에서 3000마이크로세컨드 안에 값이 안 올 경우 그 경우에만 값 무시 후 다시 새롭게 값 호출을 하는 방식으로 해결했습니다.
2. 팀원들 간의 불화는 없었나?
    1. 사실 처음에 주제를 선정하는 과정에서 팀원들 간에 의견 불일치가 있었습니다. 더 멋지고 질높은 작품을 만들고자 했던 팀원과 하나라도 제대로 해보자는 팀원의 의견이 맞지 않았지만, 결국 의견을 조율하고 기존 아이디어에 많은 기능을 추가해서 다기능 작품을 제작해보자는 쪽으로 투합했습니다.
3. 릴레이 모듈을 사용한 이유는?
    1. 테스트하던 중에 GPS 센서와 MPU6050 센서의 값을 각각 시리얼에 연결해 통신하도록 하면 서로 간섭이 생겨서 제대로된 값을 구현할 수 없다는 사실을 알게 되어, 정확한 시간 간격에 따라 두 센서값을 각각 활성화시킬 수 있도록 릴레이 5V 모듈을 이용하는 것으로 해결했습니다.
4. 앞으로 더 확장시켜보고 싶은게 있는가?
    1. 심전도 센서가 예산과는 맞지 않아 구매하지 못했는데 이것을 구매할 수 있다면, 심박과 관련된 건강 체크 기능과 부가적인 헬스케어 부분을 추가해서 아동용을 벗어난 성인용 전기 자전거까지도 제작해보고 싶습니다.
5. 개인적으로 생각하는 한계는?
    1. 이 작품의 한계는 바로 블루투스 모듈입니다. 정말 멀리 떨어지면, 통신이 끊어지기 때문에 gps 센서값을 받아오지 못해 위치도 찾을 수 없습니다. 그래서 저희는 만약 예산과 시간에 있어서 여유가 있었다면, 유심 인식 모듈을 이용해서 셀룰러 데이터로 작동하는 인터넷 기반 통신 시스템을 제작해보고 싶다는 아쉬움을 가지고 있습니다.
    2. 크기도 좀 아쉬운 부분이라고 생각합니다. 저희도 크게 자전거를 제작해서 직접 시승해볼 수 있는 체험부스를 상상했는데, 스케일이 너무 커지면 시간적인 면에서 부담감이 커질 것 같아 저희가 현실적으로 시연할 수 있는 사이즈까지만 제작한 것이 아쉬움이 남습니다.
    3. 예산 문제로 GPS 센서를 저렴한 것으로 구매했더니, 시간, 위도, 경도 이 3가지 위성에 모두 연결해서 위치값을 완벽히 잡아오는데 시간이 너무 걸린다는 것이 단점입니다. 제작 후 테스트하는데 시간이 너무 걸려서 같은 센서를 사용한 다른 분들의 블로그를 보면, 모두 gps센서는 비싼 것을 구매해야 한다는 조언이 있어서 이러한 점에서 아쉬움이 있습니다.
